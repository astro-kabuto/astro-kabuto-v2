<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gallery | Astro Kabuto</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header class="header">
    <a class="brand" href="index.html">
      <strong>Astro Kabuto</strong><br>
      <small>兜丸の成長記録サイト</small>
    </a>
  </header>

  <main class="container">
    <h1>Gallery</h1>
    <p class="sub">兜丸の写真記録</p>

    <div class="grid">
      <img class="gimg"src="images/gallery/2026-01-09_kabuto (1).jpg">
      <img class="gimg"src="images/gallery/2026-01-09_kabuto (2).jpg">
      <img class="gimg"src="images/gallery/2026-01-09_kabuto (3).jpg">
      <img class="gimg"src="images/gallery/2026-01-09_kabuto (4).jpg">
      <img class="gimg"src="images/gallery/2026-01-09_kabuto (5).jpg">
      <img class="gimg"src="images/gallery/2026-01-09_kabuto (6).jpg">
      <img class="gimg"src="images/gallery/2026-01-09_kabuto (7).jpg">
      <img class="gimg"src="images/gallery/2026-01-09_kabuto (8).jpg">
    </div>

    <p style="margin-top:40px;">
      <a href="index.html">← Homeへ戻る</a>
    </p>
  </main>
 <!-- Lightbox -->
<div id="lightbox" class="lightbox" aria-hidden="true">
  <button class="lightbox-btn prev" id="lightboxPrev" aria-label="Prev">‹</button>

  <figure class="lightbox-figure">
    <button class="lightbox-close" id="lightboxClose" aria-label="Close">×</button>
    <img id="lightboxImg" alt="">
    <figcaption id="lightboxCap" class="lightbox-cap"></figcaption>
  </figure>

  <button class="lightbox-btn next" id="lightboxNext" aria-label="Next">›</button>
</div>
<script>
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = document.getElementById("lightboxImg");
  const lightboxCap = document.getElementById("lightboxCap");
  const closeBtn = document.getElementById("lightboxClose");
  const prevBtn = document.getElementById("lightboxPrev");
  const nextBtn = document.getElementById("lightboxNext");

  const images = Array.from(document.querySelectorAll(".gimg"));
  let currentIndex = -1;

  function showAt(index) {
    if (!images.length) return;
    currentIndex = (index + images.length) % images.length; // ループ
    const img = images[currentIndex];
    lightboxImg.src = img.src;
    lightboxCap.textContent = img.dataset.caption || "";
  }

  function openLightbox(index) {
    lightbox.classList.add("open");
    lightbox.setAttribute("aria-hidden", "false");
    showAt(index);
  }

  function closeLightbox() {
    lightbox.classList.remove("open");
    lightbox.setAttribute("aria-hidden", "true");
    lightboxImg.src = "";
    currentIndex = -1;
  }

  function next() { if (currentIndex !== -1) showAt(currentIndex + 1); }
  function prev() { if (currentIndex !== -1) showAt(currentIndex - 1); }

  images.forEach((img, i) => {
    img.addEventListener("click", () => openLightbox(i));
  });

  nextBtn.addEventListener("click", next);
  prevBtn.addEventListener("click", prev);
  closeBtn.addEventListener("click", closeLightbox);

  // 背景クリックで閉じる
  lightbox.addEventListener("click", (e) => {
    if (e.target === lightbox) closeLightbox();
  });

  // 画像の左右クリックで移動（左=prev / 右=next）
  lightboxImg.addEventListener("click", (e) => {
    const rect = lightboxImg.getBoundingClientRect();
    const x = e.clientX - rect.left;
    if (x < rect.width / 2) prev();
    else next();
  });

  // キーボード操作
  document.addEventListener("keydown", (e) => {
    if (!lightbox.classList.contains("open")) return;
    if (e.key === "Escape") closeLightbox();
    if (e.key === "ArrowRight") next();
    if (e.key === "ArrowLeft") prev();
  });
  // --- Swipe (mobile) ---
  let touchStartX = 0;
  let touchStartY = 0;
  let touchEndX = 0;
  let touchEndY = 0;

  function handleSwipe() {
    const dx = touchEndX - touchStartX;
    const dy = touchEndY - touchStartY;

    // 縦スクロールを邪魔しない（横スワイプが強いときだけ反応）
    if (Math.abs(dx) < 40 || Math.abs(dx) < Math.abs(dy)) return;

    if (dx < 0) next();   // 左にスワイプ → 次へ
    else prev();          // 右にスワイプ → 前へ
  }

  // lightbox 全体でスワイプを取る
  lightbox.addEventListener("touchstart", (e) => {
    if (!lightbox.classList.contains("open")) return;
    touchStartX = e.changedTouches[0].screenX;
    touchStartY = e.changedTouches[0].screenY;
  }, { passive: true });

  lightbox.addEventListener("touchend", (e) => {
    if (!lightbox.classList.contains("open")) return;
    touchEndX = e.changedTouches[0].screenX;
    touchEndY = e.changedTouches[0].screenY;
    handleSwipe();
  }, { passive: true });
  // --- Zoom (double click / double tap) + drag to pan ---
  let zoomed = false;
  let scale = 2; // 2倍
  let panX = 0, panY = 0;
  let isPanning = false;
  let startX = 0, startY = 0;

  function applyTransform() {
    if (!zoomed) {
      lightboxImg.classList.remove("zoomed");
      lightboxImg.style.transform = "translate(0px, 0px) scale(1)";
      panX = 0; panY = 0;
      return;
    }
    lightboxImg.classList.add("zoomed");
    lightboxImg.style.transform = `translate(${panX}px, ${panY}px) scale(${scale})`;
  }

  function toggleZoom() {
    zoomed = !zoomed;
    applyTransform();
  }

  // PC: ダブルクリックでズーム
  lightboxImg.addEventListener("dblclick", (e) => {
    e.preventDefault();
    toggleZoom();
  });

  // Mobile: ダブルタップでズーム
  let lastTap = 0;
  lightboxImg.addEventListener("touchend", (e) => {
    const now = Date.now();
    if (now - lastTap < 300) {
      // ダブルタップ
      e.preventDefault();
      toggleZoom();
      lastTap = 0;
    } else {
      lastTap = now;
    }
  }, { passive: false });

  // ドラッグで移動（PC）
  lightboxImg.addEventListener("mousedown", (e) => {
    if (!zoomed) return;
    isPanning = true;
    startX = e.clientX - panX;
    startY = e.clientY - panY;
  });

  document.addEventListener("mousemove", (e) => {
    if (!isPanning) return;
    panX = e.clientX - startX;
    panY = e.clientY - startY;
    applyTransform();
  });

  document.addEventListener("mouseup", () => {
    isPanning = false;
  });

  // ドラッグで移動（スマホ）
  lightboxImg.addEventListener("touchstart", (e) => {
    if (!zoomed) return;
    isPanning = true;
    startX = e.touches[0].clientX - panX;
    startY = e.touches[0].clientY - panY;
  }, { passive: true });

  lightboxImg.addEventListener("touchmove", (e) => {
    if (!isPanning || !zoomed) return;
    panX = e.touches[0].clientX - startX;
    panY = e.touches[0].clientY - startY;
    applyTransform();
  }, { passive: true });

  lightboxImg.addEventListener("touchend", () => {
    isPanning = false;
  }, { passive: true });

  // 画像切り替え/閉じる時はズーム解除
  const _closeLightbox = closeLightbox;
  closeLightbox = function() {
    zoomed = false;
    applyTransform();
    _closeLightbox();
  };

  const _showAt = showAt;
  showAt = function(index) {
    zoomed = false;
    applyTransform();
    _showAt(index);
  };

</script>



</body>
</html>
